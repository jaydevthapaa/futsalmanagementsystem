<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Futsal Management System</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

</head>
<body>
    <div class="dash-container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-section="dashboard">Dashboard</div>
            <div class="nav-tab" data-section="grounds">Manage Grounds</div>
            <div class="nav-tab" data-section="users">View Users</div>
            <div class="nav-tab" data-section="profile">Profile</div>
            <a class="nav-tab" href="{% url 'logout' %}">Logout</a>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="admin-section active">
            <h2>Admin Dashboard</h2>
            <div class="dash-grid">
                <div class="dash-card">
                    <h3>Total Users</h3>
                    <div>{{ total_users }}</div>
                </div>
                <div class="dash-card">
                    <h3>Total Grounds</h3>
                    <div>{{ total_grounds }}</div>
                </div>
                <div class="dash-card">
                    <h3>Recent</h3>
                    <div>{{ recent_grounds|length }}</div>
                </div>
            </div>

            <h3 style="margin-top:20px;">Recent Grounds</h3>
            <ul class="list">
                {% for g in recent_grounds %}
                <li><strong>{{ g.groundName }}</strong> — {{ g.location }} — Rs. {{ g.price_per_hour }}/hr</li>
                {% empty %}
                <li>No grounds yet.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Grounds Management Section -->
        <div id="grounds" class="admin-section">
            <h2>Futsal Grounds</h2>
            <p><a class="auth-link" href="#" data-section="grounds-form">Add Ground</a></p>
            
            <!-- Grounds List -->
            <div id="grounds-list">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Price/hr</th>
                            <th>Available</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for g in grounds %}
                        <tr>
                            <td>{{ g.groundName }}</td>
                            <td>{{ g.location }}</td>
                            <td>{{ g.price_per_hour }}</td>
                            <td>{{ g.is_available|yesno:"Yes,No" }}</td>
                            <td class="actions-cell">
                                <a class="auth-link js-edit-ground" href="#" data-ground-id="{{ g.pk }}">Edit</a>
                                <a class="auth-link btn-danger ml-10 js-delete-ground" href="#" data-ground-id="{{ g.pk }}" data-ground-name="{{ g.groundName }}">Delete</a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="5" style="padding:12px;">No grounds yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Ground Form -->
            <div id="grounds-form" class="admin-section">
                <h2>{% if is_edit %}Edit{% else %}Create{% endif %} Ground</h2>
                <form class="auth-form" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_groundName">Name</label>
                        {{ form.groundName }}
                        {% if form.groundName.errors %}<div class="field-error">{{ form.groundName.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_location">Location</label>
                        {{ form.location }}
                        {% if form.location.errors %}<div class="field-error">{{ form.location.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_description">Description</label>
                        {{ form.description }}
                        {% if form.description.errors %}<div class="field-error">{{ form.description.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_price_per_hour">Price per hour</label>
                        {{ form.price_per_hour }}
                        {% if form.price_per_hour.errors %}<div class="field-error">{{ form.price_per_hour.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_image">Image</label>
                        {{ form.image }}
                        {% if form.image.errors %}<div class="field-error">{{ form.image.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_is_available">Available</label>
                        {{ form.is_available }}
                        {% if form.is_available.errors %}<div class="field-error">{{ form.is_available.errors.0 }}</div>{% endif %}
                    </div>
                    <button type="submit" class="auth-button">Save</button>
                    <a href="#" class="auth-link ml-10" data-section="grounds">Cancel</a>
                </form>
            </div>

            <!-- Ground Delete Confirmation -->
            <div id="grounds-delete" class="admin-section">
                <h2>Delete Ground</h2>
                <p>Are you sure you want to delete <strong id="ground-name"></strong>?</p>
                <form method="post" id="delete-ground-form">
                    {% csrf_token %}
                    <button type="submit" class="auth-button btn-danger">Confirm Delete</button>
                    <a href="#" class="auth-link ml-10" data-section="grounds">Cancel</a>
                </form>
            </div>
        </div>

        <!-- Users Management Section -->
        <div id="users" class="admin-section">
            <h2>Users</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Staff</th>
                        <th>Superuser</th>
                        <th>Date Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr>
                        <td>{{ u.username }}</td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.is_staff|yesno:"Yes,No" }}</td>
                        <td>{{ u.is_superuser|yesno:"Yes,No" }}</td>
                        <td>{{ u.date_joined|date:"Y-m-d" }}</td>
                        <td>
                            <a class="auth-link js-edit-user" href="#" data-user-id="{{ u.pk }}">Edit</a>
                            {% if request.user.pk != u.pk %}
                            <a class="auth-link btn-danger ml-10 js-delete-user" href="#" data-user-id="{{ u.pk }}" data-username="{{ u.username }}">Delete</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5">No users.</td></tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- User Edit Form -->
            <div id="user-form" class="admin-section">
                <h2>Edit User: <span id="user-username"></span></h2>
                <form class="auth-form" method="post" id="user-edit-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_username">Username</label>
                        {{ form.username }}
                        {% if form.username.errors %}<div class="field-error">{{ form.username.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_email">Email</label>
                        {{ form.email }}
                        {% if form.email.errors %}<div class="field-error">{{ form.email.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_is_staff">Staff</label>
                        {{ form.is_staff }}
                        {% if form.is_staff.errors %}<div class="field-error">{{ form.is_staff.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_is_superuser">Superuser</label>
                        {{ form.is_superuser }}
                        {% if form.is_superuser.errors %}<div class="field-error">{{ form.is_superuser.errors.0 }}</div>{% endif %}
                    </div>
                    <button type="submit" class="auth-button">Save</button>
                    <a href="#" class="auth-link ml-10" data-section="users">Cancel</a>
                </form>
            </div>

            <!-- User Delete Confirmation -->
            <div id="user-delete" class="admin-section">
                <h2>Delete User</h2>
                <p>Are you sure you want to delete <strong id="user-name"></strong>?</p>
                <form method="post" id="delete-user-form">
                    {% csrf_token %}
                    <button type="submit" class="auth-button btn-danger">Confirm Delete</button>
                    <a href="#" class="auth-link ml-10" data-section="users">Cancel</a>
                </form>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile" class="admin-section">
            <h2>Admin Profile</h2>
            <p><strong>Name:</strong> {{ admin_user.username }}</p>
            <p><strong>Email:</strong> {{ admin_user.email }}</p>
            <p class="mt-20">
                <a href="{% url 'logout' %}" class="auth-link">Logout</a>
            </p>
        </div>
    </div>

    <script src="{% static 'auto_hide_alerts.js' %}"></script>
    <script>
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Hide all nav tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Activate corresponding nav tab
            const targetTab = document.querySelector(`.nav-tab[data-section="${sectionId}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        // Delegated events
        document.addEventListener('click', function(e) {
            const tab = e.target.closest('.nav-tab[data-section]');
            if (tab) {
                e.preventDefault();
                showSection(tab.getAttribute('data-section'));
                return;
            }

            const linkSection = e.target.closest('a[data-section]');
            if (linkSection) {
                e.preventDefault();
                showSection(linkSection.getAttribute('data-section'));
                return;
            }

            const editGroundBtn = e.target.closest('.js-edit-ground');
            if (editGroundBtn) {
                e.preventDefault();
                showSection('grounds-form');
                return;
            }

            const deleteGroundBtn = e.target.closest('.js-delete-ground');
            if (deleteGroundBtn) {
                e.preventDefault();
                const groundId = deleteGroundBtn.getAttribute('data-ground-id');
                const groundName = deleteGroundBtn.getAttribute('data-ground-name');
                document.getElementById('ground-name').textContent = groundName;
                document.getElementById('delete-ground-form').action = `/dashboard/grounds/${groundId}/delete/`;
                showSection('grounds-delete');
                return;
            }

            const editUserBtn = e.target.closest('.js-edit-user');
            if (editUserBtn) {
                e.preventDefault();
                showSection('user-form');
                return;
            }

            const deleteUserBtn = e.target.closest('.js-delete-user');
            if (deleteUserBtn) {
                e.preventDefault();
                const userId = deleteUserBtn.getAttribute('data-user-id');
                const username = deleteUserBtn.getAttribute('data-username');
                document.getElementById('user-name').textContent = username;
                document.getElementById('delete-user-form').action = `/dashboard/users/${userId}/delete/`;
                showSection('user-delete');
            }
        });
    </script>
</body>
</html>